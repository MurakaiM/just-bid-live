"use strict";var tabs,table,tableDisabled,tableAuctions,tableWinnings,dataStats,payoutsStats,personalStats,winningsDetails,winningItem=null;$(function(){return onLoad()});function onLoad(){$("thead th[data-content]").popup({position:"top center"}),SetUpWinnings(),SetUpPersonal(),SetUpProducts(),SetUpDisabled(),SetUpPayouts(),SetUpAuction(),SetUpHome(),tabs=new Tabs({headers:".tabs.head",contents:".tabs.body"},{winnings:{onOpen:function onOpen(a,b){return tableWinnings.loadInSegment("/seller/winning/all",a,b)},onClose:function onClose(){return tableWinnings.forceDelete}},products:{onOpen:function onOpen(a,b){return table.loadInSegment("/seller/product/all",a,b)},onClose:function onClose(){return table.forceDelete()}},disabled:{onOpen:function onOpen(a,b){return tableDisabled.loadInSegment("/seller/product/disabled",a,b)},onClose:function onClose(){return tableDisabled.forceDelete()}},auctions:{onOpen:function onOpen(a,b){return tableAuctions.loadInSegment("/seller/auction/all",a,b)},onClose:function onClose(){return tableAuctions.forceDelete()}},home:{onOpen:function onOpen(a,b){dataStats.load(a,b)},onClose:function onClose(){dataStats.image.attr("src","")}},payouts:{onOpen:function onOpen(a,b){payoutsStats.load(a,b)},onClose:function onClose(){}},personal:{onOpen:function onOpen(a,b){return personalStats.load(a,b)},onClose:function onClose(){}}}),$("#signout").click(function(){return POST("/user/signout")})}function reworkRating(a){for(var d=parseInt(a?a:0),b="<div class=\"ui star rating rated\" >",c=1;5>=c;c++)b+=c<=d?"<i class=\"icon active\"></i>":"<i class=\"icon\"></i>";return b+"</div>"}function reworkStock(a,b){return!0===b?"\n    <td class=\"stock negative\">\n      <i class=\"attention icon\"></i>\n      "+a+"\n    </td>":"<td class=\"stock\">"+a+"</td>"}function reworkBoolean(a){var b=a?"checkmark green":"remove red";return"<td style=\"text-align:center;\"> <i class=\""+b+" icon\"></i> </td>"}function SetUpPayouts(){function a(f,g){var h={amount:0,fee:0},j={amount:0,fee:0},l=f.result.requested.payout;!0==f.result.requested.requested?payoutsStats.requested.html("<b>$"+toCurrency(l.amount/100)+"</b> was requested at <b>"+new Date(l.createdAt).toLocaleDateString()+"</b>. \n               Current status - <b>"+l.status+"</b>.\n               You can't request new payout until this request is not finished.\n              "):payoutsStats.requested.html("no earnings were requested for now."),payoutsStats.paidAvailable=!f.result.requested.requested,payoutsStats.pendingList.empty(),payoutsStats.availableList.empty(),payoutsStats.requestedList.empty(),f.result.pending.forEach(function(m){h.amount+=m.amount?m.amount:0,h.fee+=m.fee?m.fee:0,payoutsStats.pendingList.append(b(m,!1))}),f.result.available.forEach(function(m){m.amount-=m.fee,j.amount+=m.amount?m.amount:0,j.fee+=m.fee?m.fee:0,payoutsStats.availableList.append(b(m,!0))}),f.result.listed.forEach(function(m){return payoutsStats.requestedList.append(b(m))}),0==f.result.pending.length&&payoutsStats.pendingList.append(c()),0==f.result.available.length&&payoutsStats.availableList.append(c()),0==f.result.listed.length&&payoutsStats.requestedList.append(c()),payoutsStats.pending.text("$"+toCurrency(h.amount/100)),payoutsStats.available.text("$"+toCurrency(j.amount/100)),payoutsStats.reqSummary.text("$"+toCurrency(l?l.amount/100:0)),g.removeClass("loading")}function b(f){var h=$("<div class=\"row no-margin\" data-id=\""+f.itemId+"\">\n                        <div class=\"three wide column flex center\"> \n                          <button class=\"ui compact button\">Details</button> \n                        </div>\n                        <div class=\"two wide column flex center\">\n                          <span class=\"currency\"> $"+toCurrency((f.amount?f.amount:0)/100)+" </span>\n                        </div>\n                        <div class=\"two wide column flex center\">\n                          <span class=\"currency\">$"+toCurrency((f.fee?f.fee:0)/100)+" </span>\n                        </div>\n                        <div class=\"four wide column flex center\">\n                          <span class=\"inline-link\"> "+f.type+" </span>\n                        </div>     \n                        <div class=\"five wide column flex center\"> \n                          <span class=\"inline-link\"> "+new Date(f.createdAt).toLocaleString()+" </span>\n                        </div>                                        \n                      </div>"),j=h.data("id");return h.find("button").click(function(){winningItem=j,winningsDetails.toggleState()}),h}function c(){return"<div class=\"paidempty\"> No records to show </div>"}var d=$("#payouts");payoutsStats={load:function load(f,g){LoadSegment("/seller/store/payouts",f,g).then(function(h){return a(h.result.data,g)}).catch()},requested:d.find("#requested"),pending:d.find(".big.itemed[data-tab=\"pending\"] .money"),available:d.find(".big.itemed[data-tab=\"available\"] .money"),reqSummary:d.find(".big.itemed[data-tab=\"requested\"] .money"),pendingList:d.find(".tab.segment[data-tab=\"pending\"] .grid.wr"),requestedList:d.find(".tab.segment[data-tab=\"requested\"] .grid.wr"),availableList:d.find(".tab.segment[data-tab=\"available\"] .grid.wr"),paidAvailable:!1},$(".menu .itemed").tab({onVisible:function onVisible(f){return"available"==f&&payoutsStats.paidAvailable?$("#getpaid").removeClass("disabled"):$("#getpaid").addClass("disabled")}})}function SetUpHome(){function a(c,d){dataStats.title.text(c.seller.title),dataStats.description.text(c.seller.description),dataStats.subtitle.text(c.seller.subtitle),dataStats.solds.text(c.allSolds?c.allSolds:0),dataStats.views.text(c.allViews?c.allViews:0),dataStats.orders.text(c.allOrders?c.allOrders:0),dataStats.products.text(c.allProducts?c.allProducts:0),c.seller.cover&&(dataStats.image.addClass("avatar"),dataStats.image.attr("src",c.seller.cover)),d.removeClass("loading")}var b=$("#home");dataStats={load:function load(c,d){LoadSegment("/seller/store/statistics",c,d).then(function(f){return a(f.result.data,d)}).catch()},wrapper:b,image:b.find("img"),title:b.find(".title"),subtitle:b.find(".subtitle"),description:b.find(".description"),solds:b.find(".allSolds"),views:b.find(".allViews"),orders:b.find(".allOrders"),products:b.find(".allProducts")}}function SetUpPersonal(){function a(){personalStats.informationButton.addClass("loading"),personalStats.informationTitle.addClass("disabled"),personalStats.informationSubtitle.addClass("disabled"),personalStats.informationDescription.addClass("disabled")}function b(){personalStats.informationButton.removeClass("loading"),personalStats.informationTitle.removeClass("disabled"),personalStats.informationSubtitle.removeClass("disabled"),personalStats.informationDescription.removeClass("disabled")}function c(){personalStats.avatarButton.addClass("loading"),personalStats.avatarSelectable.addClass("disabled")}function d(){personalStats.avatarButton.removeClass("loading"),personalStats.avatarSelectable.removeClass("disabled")}function f(){personalStats.paypalButton.addClass("loading"),personalStats.paypalInput.addClass("disabled")}function g(){personalStats.paypalButton.removeClass("loading"),personalStats.paypalInput.removeClass("disabled")}function h(k,l){personalStats.data=k,k.paypalEmail&&(personalStats.paypalInput.val(k.paypalEmail),new Date().getTime()<new Date(k.paypalAccepted).getTime()?(personalStats.paypalAvaiting.removeClass("hidden"),$("#paypal_date").text(new Date(k.paypalAccepted).toLocaleDateString())):personalStats.paypalSuccess.removeClass("hidden")),k.cover&&(personalStats.avatarImg.addClass("avatar"),personalStats.avatarImg.attr("src",k.cover)),personalStats.informationTitle.val(k.title),personalStats.informationSubtitle.val(k.subtitle),personalStats.informationDescription.val(k.description),l.removeClass("loading")}var j=$("#personal");personalStats={data:null,load:function load(k,l){LoadSegment("/seller/store/personal",k,l).then(function(m){return h(m.result.data,l)}).catch()},wrapper:j,paypalForm:j.find("#paypal_update"),paypalButton:j.find("#paypal_update button"),paypalInput:j.find("#paypal_update input"),paypalAvaiting:j.find("#paypal_update .ui.message.yellow"),paypalSuccess:j.find("#paypal_update .ui.message.green"),paypalError:j.find("#paypal_update .ui.message.red"),avatarForm:j.find("#avatar_update"),avatarSelectable:j.find("#avatar_update label.ui.button.submit"),avatarButton:j.find("#avatar_update button"),avatarImg:j.find("#avatar_update img"),avatarInput:j.find("#new_avatar"),avatarSuccess:j.find("#avatar_update .ui.green"),avatarError:j.find("#avatar_update .ui.red"),informationForm:j.find("#info_update"),informationTitle:j.find("#info_update input[name=\"title\"]"),informationSubtitle:j.find("#info_update input[name=\"subtitle\"]"),informationDescription:j.find("#info_update textarea[name=\"description\"]"),informationButton:j.find("#info_update button"),informationSuccess:j.find("#info_update .ui.message.green"),informationError:j.find("#info_update .ui.message.red")},personalStats.paypalForm.submit(function(k){return k.preventDefault(),!1}),personalStats.paypalForm.form({inline:!0,fields:{paypalEmail:{rules:[{type:"email",prompt:"Please enter email in valid format"}]}}}),personalStats.paypalButton.click(function(){personalStats.paypalForm.form("is valid")&&personalStats.paypalInput.val()!=personalStats.data.paypalEmail&&(f(),POST("/seller/payout/paypal/update",{email:personalStats.paypalInput.val()}).then(function(){g();var m=new Date;m.setDate(m.getDate()+3),personalStats.paypalSuccess.addClass("hidden"),personalStats.paypalAvaiting.removeClass("hidden"),$("#paypal_date").text(m.toLocaleDateString())}).catch(function(){return g()}))}),personalStats.avatarForm.submit(function(k){return k.preventDefault(),!1}),personalStats.avatarButton.click(function(){c(),FormPOST("/seller/avatar/update",new FormData(personalStats.avatarForm[0])).then(function(){d(),personalStats.avatarSuccess.removeClass("hidden"),setTimeout(function(){return personalStats.avatarSuccess.addClass("hidden")},5e3)}).catch(function(){d(),personalStats.avatarError.removeClass("hidden"),setTimeout(function(){return personalStats.avatarError.addClass("hidden")},5e3)})}),personalStats.informationForm.submit(function(k){return k.preventDefault(),!1}),personalStats.informationForm.form({fields:{title:{rules:[{type:"empty",prompt:"Please enter store title"}]},subtitle:{rules:[{type:"empty",prompt:"Please enter store subtitle"}]},description:{rules:[{type:"empty",prompt:"Please enter store description"},{type:"maxLength[255]",prompt:"Description is too long"}]}}}),personalStats.informationButton.click(function(){personalStats.informationForm.form("is valid")&&(a(),POST("/seller/information/update",{title:personalStats.informationTitle.val(),subtitle:personalStats.informationSubtitle.val(),description:personalStats.informationDescription.val()}).then(function(){b(),personalStats.informationSuccess.removeClass("hidden"),setTimeout(function(){return personalStats.informationSuccess.addClass("hidden")},5e3)}).catch(function(){b(),personalStats.informationError.removeClass("hidden"),setTimeout(function(){return personalStats.informationError.addClass("hidden")},5e3)}))}),personalStats.avatarInput.on("change",function(){return readURL(personalStats.avatarInput,personalStats.avatarImg)})}function SetUpProducts(){function a(u,v,w,x,y,z){$(v.find(".ui.search.cat")).search({type:"category",minCharacters:2,apiSettings:{onResponse:function onResponse(C){return C.results={},C.data.forEach(function(D,E){var F=D.category||"Unknown";return!(E>=8)&&void(void 0===C.results[F]&&(C.results[F]={name:F,results:[]}),C.results[F].results.push({title:D.name}))}),C},url:"/seller/categories/search={query}"}});var B=new Form(v.find("form"),"/seller/product/create",{on:"blur",inline:!0,rules:{title:{identifier:"title",rules:[{type:"empty",prompt:"Please enter product title"}]},cost:{identifier:"cost",rules:[{type:"currency",prompt:"Please enter valid cost in format XX.XX"}]},shipment:{identifier:"shipment",rules:[{type:"shipment",prompt:"Please enter valid cost in format XX.XX (0$ - 30$)"}]},delivery:{identifier:"delivery",rules:[{type:"integer[1..180]",prompt:"Please enter valid delivery time (days)"}]},category:{identifier:"category",rules:[{type:"empty",prompt:"Please search for categories and select"}]},description:{identifier:"description",rules:[{type:"empty",prompt:"Please enter product description"},{type:"minLength[20]",prompt:"Minimum 20 symbols"},{type:"maxLength[250]",prompt:"Maximum 250 symbols"}]},stock:{identifier:"material",rules:[{type:"empty",prompt:"Please enter material title of product"}]},guarantee:{identifier:"guarantee",rules:[{type:"integer[1..72]",prompt:"Please enter guarantee (Months)"}]}},success:function success(C){z.forceRow(C),w.forceEmpty(),y.setValue(""),u.toggleState()},dataMiddleware:function dataMiddleware(C){return Object.keys(w.getData()).forEach(function(D){return delete w.getData()[D].uri}),Object.keys(w.getData()).forEach(function(D){return C.append("filefor"+D,w.getData()[D].image)}),C.append("colors",JSON.stringify(w.getData())),C.append("sizes",JSON.stringify(x.getData())),C.append("full",y.getValue()),C}},!0);n.setForm(B)}function b(u,v,w){u.empty(),u.append(c(v,"colors",w.prTypes.colors)),u.append(c(v,"sizes",w.prTypes.sizes)),u.removeClass("loading")}function c(u,v,w){if(w&&0!=Object.keys(w).length){var x=$("<div class='ui grid'></div>");return Object.keys(w).forEach(function(y){return x.append(new f(v,u,w[y]).template())}),x.append("<div class=\"ui divider fitted\"></div>"),x}}function d(u,v,w){u.empty(),u.append(function(y,z){if(z&&0!=Object.keys(z).length){var A=$("<div class='ui grid'></div>");return Object.keys(z).forEach(function(B){return A.append(new g(v,z[B]).template())}),A.append("<div class=\"ui divider fitted\"></div>"),A}}("stocks",w)),u.removeClass("loading")}function f(u,v,w){var x=this;return this.isDisabled=!0==w.disable,this.generateButton=function(y){var z={};return!0==y?(z.classes="ui button tiny green",z.title="Enable"):(z.classes="ui button tiny red",z.title="Disable"),"<button type=\"button\" class=\""+z.classes+"\"> "+z.title+" </button>"},this.switchButton=function(y){y.toggleClass("loading"),x.isDisabled?(y.removeClass("red"),y.addClass("green"),y.text("Enable")):(y.removeClass("green"),y.addClass("red"),y.text("Disable"))},this.row=$("<div class=\"three column row wrap\">\n      <div class=\"column flexfull center\">"+w.title+"</div>\n      <div class=\"column\"> <input type=\"text\" class=\"partlydisabled\" value=\""+w.value+"\"/></div>\n      <div class=\"column flexfull center\"> "+this.generateButton(this.isDisabled)+" </div>\n    </div>"),this.button=this.row.find("button"),this.button.click(function(){x.button.addClass("loading"),x.isDisabled=!x.isDisabled,POST("/seller/product/typesout",{uid:v,available:x.isDisabled,name:w.value,group:u}).then(function(){return x.switchButton(x.button)})}),this.template=function(){return x.row},this}function g(u,v){var w=this;return this.row=$("    \n        <div class=\"row wrap\"> \n          <form class=\"column ui form\">\n              <div class=\"three fields\">        \n                <div class=\"field flexfull center\">"+v.title+"</div>\n                <div class=\"field\"> <input type=\"text\" name=\"stock\" value=\""+v.inStock+"\"/> </div>\n                <div class=\"field flexfull center\"> <button type=\"submit\" class=\"ui button tiny submit\" > Update </button> </div>  \n              </div> \n              <div class=\"ui message success\">\n                  <div class=\"header\">Action Completed</div>\n                  <p> Product's type stock was updated </p>\n              </div>\n              <div class=\"ui custom message error\">\n                <div class=\"header\">Action Forbidden</div>\n                <p></p>\n              </div>\n          </form>  \n        </div>\n      "),this.form=new Form(this.row.find("form"),"/seller/product/stock",{on:"blur",inline:!0,delay:250,justbutton:!0,rules:{stock:{identifier:"stock",rules:[{type:"integer[1..99999]",prompt:"Please enter valid stock value(1 - 99999)"}]}},dataMiddleware:function dataMiddleware(x){return x.productId=u,x.typeId=v.typeId,x},success:function success(x,y){table.forceChange(j.i,x),setTimeout(function(){return y.removeClass("success")},3e3)},failure:function failure(x,y){return setTimeout(function(){return y.removeClass("error")},3e3)}}),this.template=function(){return w.row},this}$(".ui.small.icon.button").popup({position:"bottom center"});var h=null,j=null,k={open:$("#productsOpen"),delete:$("#productsDelete"),create:$("#productsCreate"),auction:$("#productAuction"),edit:$("#productsEdit"),change:$("#productsChange"),refresh:$("#productsRefresh")};Simditor.locale="en-US",toolbar=["title","bold","italic","underline","strikethrough","fontScale","color","|","ol","ul","blockquote","table","|","link","image","hr","|","indent","outdent","alignment"],table=new Table("products",{defaultSort:"updatedAt",search:"#productsSearch",forPage:"#productsDrop",buttons:{previous:".left.icon.item",next:".right.icon.item",to:".ui.button.radiusless.borderless"},input:{to:".ui.left.action input"},row:function row(u){var v=!1;return u.types.forEach(function(w){return!!(0>=w.inStock)&&(v=!0)}),$("\n        <tr>\n          <td>"+u.prTitle+"</td>\n          "+reworkStock(u.prStock,v)+"\n          <td><i class=\"dollar icon\"></i>"+toCurrency(u.prCost)+"</td>         \n          <td><i class=\"dollar icon\"></i>"+toCurrency(u.prShipment)+"</td>   \n          "+reworkBoolean(0<u.auctions.length)+"\n          <td>"+u.prViews+"</td>\n          <td>"+u.prSold+"</td>       \n          <td>"+new Date(u.updatedAt).toLocaleDateString()+"</td>\n          <td>"+new Date(u.createdAt).toLocaleDateString()+"</td>         \n        </tr>\n      ")},click:function click(u,v,w){k.auction.removeClass("disabled"),k.delete.removeClass("disabled"),k.edit.removeClass("disabled"),k.open.removeClass("disabled"),k.change.removeClass("disabled"),h={i:u,obj:v,arr:w},j={i:u}},onFocusLost:function onFocusLost(){k.auction.addClass("disabled"),k.delete.addClass("disabled"),k.edit.addClass("disabled"),k.open.addClass("disabled"),k.change.addClass("disabled"),h=null}});var l=new NestedList("#typesColorist",{listplace:".ui.grid",submiter:".teal",isFiled:{inputName:"image",pathName:"path",buttonName:"imagebutton"},inputs:[{as:"title",name:"titleVR",valid:function valid(u){return 0!=u.length}},{as:"value",name:"valueVR",valid:function valid(u){return 0!=u.length}},{name:"path",valid:function valid(u){return 0<u.length}},{name:"color",valid:function valid(){return!0}},{name:"image",valid:function valid(u){return 0!=u.length}}],mockuper:function mockuper(u,v){var w=u.image?"<img src=\""+u.uri+"\" />":" - ",x=$("   \n          <div class=\"row\">   \n            <div class=\"four wide column\">"+u.title+"</div>\n            <div class=\"four wide column\">"+u.value+"</div>          \n            <div class=\"two wide column\"><a class=\"ui circular empty label\" style=\"background : "+u.color+"; \"></a> </div>\n            <div class=\"four wide column\">"+w+"</div>\n            <div class=\"two wide column\">\n              <button class=\"ui icon button red small\"> <i class=\"trash outline icon\"></i> </button>\n            </div>  \n          </div>      \n        ");return x.find("button").click(function(){x.remove(),l.forceDelete(v)}),$(x)},maxSize:10}),m=new NestedList("#typesSize",{listplace:".ui.grid",submiter:".teal",inputs:[{as:"title",name:"titleVR",valid:function valid(u){return 0!=u.length}},{as:"value",name:"valueVR",valid:function valid(u){return 0!=u.length}}],mockuper:function mockuper(u,v){var w=$("   \n        <div class=\"row\">   \n          <div class=\"seven wide column\">"+u.title+"</div>\n          <div class=\"seven wide column\">"+u.value+"</div>  \n          <div class=\"two wide column\">\n            <button class=\"ui icon button red small\"> <i class=\"trash outline icon\"></i> </button>\n          </div>  \n        </div>      \n      ");return w.find("button").click(function(){w.remove(),m.forceDelete(v)}),$(w)}}),n=new NestedCreator(l,m,"#typesStock"),o=new Simditor({textarea:$("#createModal .wwc"),toolbar:toolbar,defaultImage:"../<%=resources%>/g.assets/img/usericons/image.png"}),p=new Modal({id:"#deleteModal",onOpen:function onOpen(u){return u.find(".exact").text(h.arr[h.i].prTitle)},onClose:function onClose(u){u.find("input").val(""),u.find("button").addClass("disabled")},middleware:function middleware(u){var v=u.find("form"),w=u.find("input"),x=u.find("button");x.addClass("disabled"),w.on("change keyup paste",function(y){y.target.value==h.arr[h.i].prTitle?x.removeClass("disabled"):x.addClass("disabled")}),x.click(function(){x.addClass("loading"),POST("/seller/product/delete",{uid:h.arr[h.i].prUid}).then(function(){h.arr.splice(h.i,1),p.toggleState(),x.removeClass("loading"),table.redraw()}).catch(function(){p.toggleState(),x.removeClass("loading")})})}},!0),q=new Modal({id:"#createModal",closer:".closer",closable:!0,overflowed:!0,onOpen:function onOpen(u){u.find("form").form("clear"),l.forceEmpty(),o.setValue(""),n.forceEmpty(),m.forceEmpty(),l.forceEmpty()},onClose:function onClose(){},middleware:function middleware(u,v,w){return a(w,u,l,m,o,table)}},!1),r=new Modal({id:"#changeModal",closer:".closer",closable:!0,overflowed:!0,onOpen:function onOpen(u,v){v.exact.text(h.arr[h.i].prTitle),v.description.val(h.arr[h.i].prDescription),v.full.setValue(h.arr[h.i].prFull)},onClose:function onClose(){},middleware:function middleware(u,v,w){v.exact=u.find(".exact"),v.description=u.find("textarea[name=\"description\"]"),v.full=new Simditor({textarea:$("#changeModal .wwc"),toolbar:toolbar,defaultImage:"../<%=resources%>/g.assets/img/usericons/image.png"}),v.form=new Form(u.find("form"),"/seller/product/change",{inline:!0,on:"blur",rules:{delivery:{identifier:"delivery",rules:[{type:"integer[1..180]",prompt:"Please enter valid delivery time (days)"}]}},dataMiddleware:function dataMiddleware(x){return x.id=h.arr[h.i].prUid,x.full=v.full.getValue(),x},success:function success(){return setTimeout(function(){return w.toggleState()},3e3)},failure:function failure(){}})}},!1),s=new Modal({id:"#editModal",reset:!0,overflowed:!0,closer:".closer",onOpen:function onOpen(u,v){var w=h.arr[h.i],x=w.prUid;v.price.input.val(w.prCost),v.shipment.input.val(w.prShipment),v.name.text(h.arr[h.i].prTitle),v.types.addClass("loading"),v.types.empty(),v.stock.addClass("loading"),v.stock.empty(),POST("/seller/product/types",{id:x}).then(function(y){return b(v.types,x,y.data)}),POST("/seller/product/stocks",{id:x}).then(function(y){return d(v.stock,x,y.data)})},onClose:function onClose(){},middleware:function middleware(u,v){var x=/^\d+([.]\d{1,2})?$/;v.price={input:u.find("input[name=\"price\"]"),button:$("#editPrice")},v.shipment={input:u.find("input[name=\"shipment\"]"),button:$("#editShipment")},v.price.button.click(function(){x.test(v.price.input.val())&&(v.price.button.addClass("loading"),POST("/seller/product/update/price",{id:h.arr[h.i].prUid,price:v.price.input.val()}).then(function(){v.price.button.removeClass("loading")}))}),v.shipment.button.click(function(){if(x.test(v.price.input.val())){var z=parseFloat(v.price.input.val());0>z||30<z||(v.shipment.button.addClass("loading"),POST("/seller/product/update/shipment",{id:h.arr[h.i].prUid,price:v.shipment.input.val()}).then(function(){v.shipment.button.removeClass("loading")}))}}),v.types=u.find(".ui.segment.types"),v.stock=u.find(".ui.segment.stock"),v.name=u.find(".exact")}},!0),t=new Modal({id:"#auctionNewModal",reset:!0,overflowed:!0,onOpen:function onOpen(u,v){v.form.removeClass("success error"),v.form.form("reset"),v.dropdown.dropdown("clear"),v.fee.val("Fee"),v.exp.val("Explanation"),v.ape.val("Appearence"),v.str.val("Starting price"),v.exact.text(h.arr[h.i].prTitle)},onClose:function onClose(){},middleware:function middleware(u,v){v.form=u.find("form"),v.submit=v.form.find("button"),v.exact=u.find(".exact"),v.fee=u.find("input[name=\"fee\"]"),v.exp=u.find("input[name=\"exp\"]"),v.ape=u.find("input[name=\"ape\"]"),v.str=u.find("input[name=\"str\"]"),v.dropdown=u.find(".ui.dropdown").dropdown({onChange:function onChange(y){currentFees[y]&&(v.fee.val("dollar"==currentFees[y].type?"$"+(currentFees[y].fee+""):currentFees[y].fee+""+"%"),v.ape.val(currentFees[y].appearance),v.exp.val(currentFees[y].explanation),"reserved"==y?(v.str.parent().removeClass("partlydisabled"),v.str.val("")):(v.str.parent().addClass("partlydisabled"),v.str.val(currentFees[y].begin)),v.form.form("validate field","str"))}}),v.preparedForm=new Form(v.form,"/seller/auction/create",{inline:!0,on:"blur",rules:{stock:{identifier:"stock",rules:[{type:"integer[1..99999]",prompt:"Stock should be positive number (1 - 99999)"}]},type:{identifier:"type",rules:[{type:"empty",prompt:"Select type of auction item"}]},str:{identifier:"str",rules:[{type:"currency",prompt:"Select valid auction starting price"}]}},dataMiddleware:function dataMiddleware(y){return y.uidProduct=h.arr[h.i].prUid,y},success:function success(){},failure:function failure(){}})}},!1);k.delete.click(function(){return p.toggleState()}),k.create.click(function(){return q.toggleState()}),k.auction.click(function(){return t.toggleState()}),k.change.click(function(){return r.toggleState()}),k.edit.click(function(){return s.toggleState()}),k.open.click(function(){return window.open("/product/id"+h.arr[h.i].prUid)}),k.refresh.click(function(){return table.loadFromCache()})}function SetUpDisabled(){var a=null,b={renew:$("#disabledRenew"),delete:$("#disabledDelete"),refresh:$("#disabledRefresh")};tableDisabled=new Table("disabled",{defaultSort:"updatedAt",search:"#disabledSearch",forPage:"#disabledDrop",buttons:{previous:".left.icon.item",next:".right.icon.item",to:".ui.button.radiusless.borderless"},input:{to:".ui.left.action input"},row:function row(f){return $(" \n        <tr>\n          <td>"+f.prTitle+"</td> \n          <td>"+reworkRating(f.prRating)+"</td>\n          <td>"+f.prViews+"</td>\n          <td>"+f.prSold+"</td>       \n          <td>"+new Date(f.updatedAt).toLocaleDateString()+"</td>               \n        </tr>\n      ")},click:function click(f,g,h){b.renew.removeClass("disabled"),b.delete.removeClass("disabled"),a={i:f,obj:g,arr:h}},onFocusLost:function onFocusLost(){b.renew.addClass("disabled"),b.delete.addClass("disabled"),a=null}});var c=new Modal({id:"#renewModal",onOpen:function onOpen(f){return f.find(".exact").text(a.arr[a.i].prTitle)},onClose:function onClose(f){f.find("input").val(""),f.find("button").addClass("disabled")},middleware:function middleware(f){var g=f.find("input"),h=f.find("button");h.addClass("disabled"),g.on("change keyup paste",function(j){j.target.value==a.arr[a.i].prTitle?h.removeClass("disabled"):h.addClass("disabled")}),h.click(function(){h.addClass("loading"),POST("/seller/product/renew",{uid:a.arr[a.i].prUid}).then(function(){a.arr.splice(a.i,1),tableDisabled.redraw(),h.removeClass("loading"),c.toggleState()}).catch(function(){c.toggleState(),h.removeClass("loading")})})}},!0),d=new Modal({id:"#finishModal",onOpen:function onOpen(f){f.find(".exact").text(a.arr[a.i].prTitle),f.find("form").removeClass("error")},onClose:function onClose(f){f.find("input").val(""),f.find("button").addClass("disabled")},middleware:function middleware(f){var g=f.find("input"),h=f.find("button"),j=f.find("form"),k=f.find(".error.message p");h.addClass("disabled"),g.on("change keyup paste",function(l){l.target.value==a.arr[a.i].prTitle?h.removeClass("disabled"):h.addClass("disabled")}),h.click(function(){h.addClass("loading"),POST("/seller/product/remove",{uid:a.arr[a.i].prUid}).then(function(){a.arr.splice(a.i,1),tableDisabled.redraw(),h.removeClass("loading"),d.toggleState()}).catch(function(m){k.text(m.reason),j.addClass("error"),h.removeClass("loading")})})}},!0);b.renew.click(function(){return c.toggleState()}),b.delete.click(function(){return d.toggleState()}),b.refresh.click(function(){return tableDisabled.loadFromCache()})}function SetUpAuction(){var a=null,b={stock:$("#auctionsStock"),pause:$("#auctionsPause"),refresh:$("#auctionsRefresh")},c=new Modal({id:"#auctionUpdateModal",onOpen:function onOpen(f){return f.find(".exact").text(a.arr[a.i].product.prTitle)},onClose:function onClose(f){return f.find("input").val("")},middleware:function middleware(f,g){g.form=new Form(f.find("form"),"/seller/auction/stock",{on:"blur",inline:!0,rules:{stock:{identifier:"stock",rules:[{type:"integer[1..99999]",prompt:"Stock should be positive number (1 - 99999)"}]}},dataMiddleware:function dataMiddleware(k){return k.uidRecord=a.arr[a.i].uidRecord,k},success:function success(k){var l=a.arr[a.i];l.inStock=k,tableAuctions.forceChange(a.i,l)},failure:function failure(){}})}},!0),d=new Modal({id:"#auctionPauseModal",onOpen:function onOpen(f,g){g.exact.text(a.arr[a.i].product.prTitle),g.current=a,a.arr[a.i].temporaryDisabled?(g.button.text("Unpause"),g.button.removeClass("red"),g.button.addClass("green")):(g.button.text("Pause"),g.button.removeClass("green"),g.button.addClass("red"))},onClose:function onClose(f,g){return g.current=null},middleware:function middleware(f,g){g.exact=f.find(".exact"),g.button=f.find("button"),g.form=new Form(f.find("form"),"/seller/auction/pause",{rules:{button:{identifier:"title",rules:[{type:"empty"}]}},dataMiddleware:function dataMiddleware(k){return k.uidRecord=g.current.arr[g.current.i].uidRecord,k.temporaryDisabled=!g.current.arr[g.current.i].temporaryDisabled,k},success:function success(){var l=g.current.arr[g.current.i];l.temporaryDisabled=!l.temporaryDisabled,tableAuctions.forceChange(g.current.i,l),redrawButton(g,l.temporaryDisabled)}})}},!0);tableAuctions=new Table("auctions",{defaultSort:"updatedAt",search:"#auctionsSearch",forPage:"#auctionsDrop",buttons:{previous:".left.icon.item",next:".right.icon.item",to:".ui.button.radiusless.borderless"},input:{to:".ui.left.action input"},row:function row(f){return $(" \n        <tr>\n          <td>"+f.productTitle+"</td> \n          <td>"+currentFees[f.uidFee].title+"</td>\n          <td>"+f.inStock+"</td>\n          <td><i class=\"dollar icon\"></i>"+toCurrency(f.currentBid)+"</td>       \n          "+reworkBoolean(f.onAuction)+"\n          "+reworkBoolean(f.isCompleted)+"\n          "+reworkBoolean(f.temporaryDisabled)+"\n          <td>"+new Date(f.updatedAt).toLocaleDateString()+"</td>\n          <td>"+new Date(f.createdAt).toLocaleDateString()+"</td>   \n        </tr>\n      ")},transformation:function transformation(f){return f.currentBid/=100,f.productTitle=f.product.prTitle,f},click:function click(f,g,h){b.stock.removeClass("disabled"),b.pause.removeClass("disabled"),a={i:f,obj:g,arr:h}},onFocusLost:function onFocusLost(){b.stock.addClass("disabled"),b.pause.addClass("disabled"),a=null}}),b.refresh.click(function(){return tableAuctions.loadFromCache()}),b.stock.click(function(){return c.toggleState()}),b.pause.click(function(){return d.toggleState()})}function SetUpWinnings(){var a=null,b={details:$("#winningsDatails"),update:$("#winningsUpdate"),refresh:$("#winningsRefresh")},c=new Modal({id:"#winningUpdateModal",onOpen:function onOpen(d){return d.find(".exact").text(a.arr[a.i].winnerName)},onClose:function onClose(){},middleware:function middleware(d,f){f.form=new Form(d.find("form"),"/seller/winning/track",{on:"blur",inline:!0,rules:{track:{identifier:"track",rules:[{type:"empty",prompt:"Type clear and proper status description"}]}},dataMiddleware:function dataMiddleware(j){return j.record=a.arr[a.i].winningId,j},success:function success(j){var k=a.arr[a.i];k.productTrack=j,k.status="Sent",tableWinnings.forceChange(a.i,k)},failure:function failure(){return console.log(error)}})}},!0);winningsDetails=new Modal({id:"#winningDetailsModal",onOpen:function onOpen(d,f){f.segment.addClass("loading"),POST("/seller/winning/especial",{winningId:winningItem}).then(function(g){return f.insertInto(g.data)}).catch(function(g){return console.log(g)})},onClose:function onClose(d,f){return f.deleteInfo()},middleware:function middleware(d,f){f.segment=d.find(".ui.segment"),f.dataValues=d.find(".details.value"),f.addresses=d.find(".col-md-6.nopadding.addressed"),f.insertInto=function(h){$(f.dataValues[0]).text(h.user.firstName+" "+h.user.lastName),$(f.dataValues[2]).text(h.customerInformation?"Address was selected":"No address was selected yet"),$(f.dataValues[1]).find("a").attr("href","/product/id"+h.productId),$(f.dataValues[1]).find("a").text(h.product.prTitle),$(f.dataValues[3]).text(h.type?h.type.title:"Type has not been selected yet"),$(f.dataValues[4]).text(h.productTrack),$(f.dataValues[5]).text(h.status),$(f.dataValues[6]).text("$ "+toCurrency(h.lastBid/100)),$(f.dataValues[7]).text("$ "+toCurrency(h.product.prShipment)),$(f.dataValues[8]).text(h.billingId?"Yes":"No"),h.customerInformation?(f.addresses.removeClass("closed"),$(f.dataValues[9]).text(h.customerInformation["shipping[first-name]"]),$(f.dataValues[10]).text(h.customerInformation["shipping[last-name]"]),$(f.dataValues[11]).text(h.customerInformation["shipping[address]"]),$(f.dataValues[14]).text(h.customerInformation["shipping[country]"]),$(f.dataValues[12]).text(h.customerInformation["shipping[city]"]),$(f.dataValues[13]).text(h.customerInformation["shipping[code]"]),$(f.dataValues[15]).text(h.customerInformation["shipping[phone]"])):f.addresses.addClass("closed"),f.segment.removeClass("loading")},f.deleteInfo=function(){return f.dataValues.each(function(h,j){return 1==h?$(j).find("a").text(""):$(j).text("")})}}},!0),tableWinnings=new Table("winnings",{defaultSort:"updatedAt",search:"#winningsSearch",forPage:"#winningsDrop",buttons:{previous:".left.icon.item",next:".right.icon.item",to:".ui.button.radiusless.borderless"},input:{to:".ui.left.action input"},row:function row(d){return $(" \n        <tr>\n          <td>"+d.winnerName+"</td>      \n          <td><i class=\"dollar icon\"></i>"+toCurrency(d.lastBid)+"</td>     \n          "+reworkStatus(d.status)+" \n          <td>"+(d.productTrack?d.productTrack:"Empty")+"</td>\n          "+reworkBoolean(d.isPaid)+"\n          <td>"+new Date(d.updatedAt).toLocaleDateString()+"</td>\n          <td>"+new Date(d.createdAt).toLocaleDateString()+"</td>   \n        </tr>\n      ")},transformation:function transformation(d){return d.winnerName=d.user.firstName+" "+d.user.lastName,d.lastBid/=100,d},click:function click(d,f,g){b.details.removeClass("disabled"),b.update.removeClass("disabled"),a={i:d,obj:f,arr:g},winningItem=a.arr[a.i].winningId},onFocusLost:function onFocusLost(){a=null,b.details.addClass("disabled"),b.update.addClass("disabled")}}),b.refresh.click(function(){return tableWinnings.loadFromCache()}),b.update.click(function(){return c.toggleState()}),b.details.click(function(){return winningsDetails.toggleState()})}function numberRebase(a){return 100>a?a:1e3>a?parseFloat(a).toFixed(2)/1e3+"h":1e6>a?parseFloat(a).toFixed(2)/1e3+"th":void 0}function redrawButton(a,b){b?(a.button.text("Unpause"),a.button.removeClass("red"),a.button.addClass("green")):(a.button.text("Pause"),a.button.removeClass("green"),a.button.addClass("red"))}function reworkStatus(a){var b="";return"New"==a?b="pr":"Paid"==a&&(b="gr"),"\n    <td>\n      <b class=\"light "+b+"\"> \n        "+a+" \n      </b>\n    </td>\n  "}function readURL(a,b){if(a[0].files[0]){var c=new FileReader;c.onload=function(d){b.addClass("avatar"),b.attr("src",d.target.result)},c.readAsDataURL(a[0].files[0])}}var currentFees={standard:{fee:2,begin:2,type:"dollar",title:"Standard Listing",explanation:"Bids Begin at $2 and bids goes up at $1 at a time",appearance:"No Color Border"},featured:{fee:3,begin:3,type:"dollar",title:"Featured Listing",explanation:"Bids Begin at $3 and bids goes up at $1 at a time",appearance:"Purple Color Border"},small:{fee:5,begin:1,type:"per",title:"Standard 20% Percent",explanation:"Bids Begin at $1 and bids goes up at 20% at a time",appearance:"Orange Color Border"},big:{fee:10,begin:1,type:"per",title:"Big Percentage 50%",explanation:"Bids Begin at $1 and bids goes up at 50% at a time",appearance:"Pink Color Border"},reserved:{fee:15,begin:"custom",type:"per",title:"Reserved Listing",explanation:"Bids Begin at selected price aand bids goes up at $1 at a time",appearance:"Red Color Border"}};