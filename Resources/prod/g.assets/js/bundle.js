"use strict";function toCurrency(n){return parseFloat(n).toFixed(2)}function AuthController(){var n,i=this,t=io.connect("/auth");$("body").click(function(n){return i.notification_bell.removeClass("opened")}),$("#btn_signout").click(function(n){return POST("/user/signout")}),$("#btn_signout").popup(),this.currentCount=0,this.isSigned=!1,this.isRedirecting=!1,this.firstLoad=!1,this.notification_cnt=$("#cnt_notification"),this.notification_bell=$("#btn_notification"),this.notification_count=$("#count_notificator"),this.notification_empty=$(".no_notification"),this.notification_login=$(".no_login"),this.listener={},this.userData={},this.notification_cnt.click(function(n){var t=$(n.target);0==t.hasClass("no_notification")&&0==t.hasClass("no_login")&&(i.isRedirecting=!0)}),this.notification_bell.click(function(n){i.loadNotification(),i.notification_bell.addClass("opened"),n.stopPropagation()}),t.on("connect",function(){t.emit("status"),t.emit("count")}),t.on("status",function(t){i.userData=t,clearInterval(n)}),t.on("exit",function(){t.close(),i.switchAuth(!1)}),t.on("disconnect",function(n){return"io server disconnect"===n?console.log("Auth channel was dropped"):console.log("Auth channel was dicsonnected")}),t.on("count",function(n){return i.countNotification(n)}),t.on("new:notification",function(n){return i.newNotification(n)}),t.on("view:notification",function(n){return i.reviewNotification(n)}),t.on("all:notification",function(){return i.reviewAllNotifications()}),$("#rvw_notification").click(function(n){return t.emit("review:all")}),this.on=function(n,t){return i.listener[n]=t},this.signIn=function(o){n=setInterval(function(){return t.connect()},150),i.userData.user=o,i.switchAuth(!0)},this.forceAuth=function(){return t.emit("status")},this.forceLoad=function(n,t){return!!n&&(i.isSigned=!0,i.userData.user=n,!0)},this.switchAuth=function(n){i.swithNotifications(n),i.isSigned=n;var t=$("#user"),o=$("#account");n?(o.css("display","none"),t.css("display","inline"),t.text("Hello, "+i.userData.user.firstName)):(i.countNotification(0),window.location.pathname.includes("seller")?window.location.href="/seller/signin":"/"!=window.location.pathname&&(window.location.href="/"),o.css("display","inline"),t.css("display","none"))},this.getData=function(){return i.userData},this.setUid=function(n){n&&(i.userData.user={uid:n})},this.loadNotification=function(){i.firstLoad||GET("/user/notifications/new").then(function(n){i.drawNotification(n.data),i.notification_cnt.removeClass("loading")}).catch(function(n){n.code&&10==n.code&&(i.notification_cnt.removeClass("loading"),i.swithNotifications(!1))})},this.swithNotifications=function(n){n?(i.firstLoad=!1,i.notification_login.hide(),i.notification_empty.show()):(i.notification_cnt.find("a").remove(),i.countNotification(0),i.notification_login.show(),i.notification_empty.hide())},this.countNotification=function(n){i.currentCount=void 0!=n&&null!=n?n:i.currentCount,i.currentCount<=0?i.notification_count.text(""):i.notification_count.text(i.currentCount)},this.reviewNotification=function(n){i.isRedirecting?i.notification_cnt.addClass("loading"):(i.notification_cnt.find('a[data-id="'+n+'"]').remove(),i.currentCount--,i.countNotification(),0==i.currentCount&&(i.notification_cnt.find("a[data-id]").remove(),i.notification_empty.show()))},this.reviewAllNotifications=function(){i.notification_cnt.find("a[data-id]").remove(),i.currentCount=0,i.countNotification(),i.notification_empty.show()},this.newNotification=function(n){i.notification_empty.hide(),i.notification_cnt.prepend(i.createNotification(n)),i.currentCount++,i.countNotification()},this.drawNotification=function(n){i.firstLoad||(i.firstLoad=!0),Array.isArray(n)&&(i.notification_cnt.find("a[data-id]").remove(),n.length>0&&i.notification_empty.hide(),n.forEach(function(n){return i.notification_cnt.append(i.createNotification(n))}))},this.createNotification=function(n){var i={imgUrl:"price-tag-6",action:""};switch(n.type){case"aw":i.imgUrl="justice",i.action="/my/winning/"+n.action;break;case"wch":i.imgUrl="insert-coin",i.action="/notification/review?id="+n.recordId+"&redirect=/my";break;case"fch":i.imgUrl="point-of-service",i.action="/my/winning/"+n.action;break;case"aprv":i.imgUrl="stamp-1",i.action="/notification/review?id="+n.recordId+"&redirect=/seller/mystore#/products";break;case"prcr":i.imgUrl="crate-5",i.action="/notification/review?id="+n.recordId+"&redirect=/seller/mystore#/products";break;default:imgUrl="price-tag-6"}return $('\n         <a class="notification" href="'+i.action+'" data-id="'+n.recordId+'">\n             <div class="image">\n               <img src="/prod/g.assets/img/commercialicons/'+i.imgUrl+'.png" alt="">\n             </div>\n             <div class="data">\n                 <div class="titles">\n                   <span class="title">'+n.title+'</span>\n                   <span class="date">'+new Date(n.updatedAt).toLocaleDateString()+'</span>\n                 </div>\n                 <div class="message">'+n.message+"</div>\n             </div>\n         </a>")}}function setUpSignSystem(){$("body").removeClass("preloading"),$("#account").click(function(n){return window.WModals.signModal.toggleState()}),window.WModals.signModal=new Modal({id:"#signModal"},!0),SignIn(window.WModals.signModal)}function createPrompt(n){return $('<div class="ui basic red pointing prompt label transition visible">'+n+"</div>")}function Form(n,i,t){function o(){d.removeClass("overall error success finished"),t.justbutton?d.find("button:submit").addClass("loading"):d.addClass("loading")}function e(n){m.error.text(n),d.removeClass("loading success"),d.addClass("overall error")}function a(){0==t.reset&&d.form("reset"),d.removeClass("loading error"),d.addClass("overall success"),1==t.finishing&&d.addClass("finished")}function r(){return d.form("get values")}for(var s=arguments.length,c=Array(s>3?s-3:0),u=3;u<s;u++)c[u-3]=arguments[u];var l=!1,d=n instanceof jQuery?n:$("#"+n),f=void 0!==t.delay||null!=t.delay?t.delay:1e3,m={success:d.find(".success p"),error:d.find(".error p")};t.on=t.on?t.on:"blur",d.form({fields:t.rules,inline:t.inline,on:t.on}),d.submit(function(n){return!l&&(n.preventDefault(),l=!0,function(n){var i=1==c[0]?new FormData(d[0]):r();t.dataMiddleware&&(i=t.dataMiddleware(i)),d.form("is valid")?(o(),setTimeout(function(){postForm(n,i,1==c[0]).then(function(n){if(t.justbutton&&d.find("button:submit").removeClass("loading"),n.code>=10)t.failure&&t.failure(n.data,d),e(n.message);else{if(t.success&&t.success(n.data,d),1==t.notSuccess)return;a()}l=!1}).catch(function(n){l=!1,e(n.message)})},f)):l=!1}(i),!1)}),this.setError=e,this.setLoading=o,this.setSuccess=a,this.addField=function(n){t.rules[n.identifier]=n,d.form({fields:t.rules,inline:t.inline,on:t.on})},this.removeField=function(n){delete t.rules[n],d.form({fields:t.rules,inline:t.inline,on:t.on})}}function Storage(){var n=this;this.callbacks=[],this.subscribe=function(n){callbacks.push(n)},this.setItem=function(i,t){n.callbacks.forEach(function(n){return n(i,t)}),localStorage.setItem(i,t)},this.getItem=function(n){return localStorage.getItem(n)}}function postForm(n,i,t){return new Promise(function(o,e){t?backendPostForm(n,i,function(n,i){n?e("Request failed"):404==i.code?e(i.message):o(i)}):backendPost(n,i,function(n,i){n?e("Request failed"):404==i.code?e(i.message):o(i)})})}function backendPost(n,i,t){$.ajax({url:n,type:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(n){t(null,n)},error:function(){t(new Error("Ajax Failed"))}})}function backendPostForm(n,i,t){$.ajax({url:n,type:"POST",data:i,async:!0,success:function(n){t(null,n)},error:function(){t(new Error("Ajax Failed"))},xhr:function(){var n=new window.XMLHttpRequest;return n.upload.addEventListener("progress",function(n){if(n.lengthComputable){var i=n.loaded/n.total;i=parseInt(100*i)}},!1),n},cache:!1,contentType:!1,processData:!1})}function backendGet(n,i){$.ajax({url:n,type:"GET",success:function(n){i(null,n)},error:function(){i(new Error("Ajax Failed"))}})}function GET(n){return new Promise(function(i,t){backendGet(n,function(n,o){return n?t(10):o.code>=10&&o.code<20?t(o):i(o)})})}function FormPOST(n,i){return new Promise(function(t,o){return backendPostForm(n,i,function(n,i){return n?o(10):i.code>=10&&i.code<20?o(i):t(i)})})}function POST(n,i){return new Promise(function(t,o){backendPost(n,i,function(n,i){return n?o(10):i.code>=10&&i.code<20?o(i):t(i)})})}function mobileDeviceInit(){var n=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(n=!0),n}function Props(){return this.isMobile=mobileDeviceInit(),this.isDynamicMobile=function(){return mobileDeviceInit()},this.disableResize=function(){var n=[window.width,window.height];$(window).resize(function(){window.resizeTo(n[0],n[1])})},this.mobilePhone=function(){$.fn.form.settings.rules.phone=function(n,i){var t=(new libphonenumber.asYouType).input(n),o=new libphonenumber.parse(t);return Object.keys(o).length>=2}},this.currency=function(){$.fn.form.settings.rules.currency=function(n,i){return/^\d+([.]\d{1,2})?$/.test(n)},$.fn.form.settings.rules.shipment=function(n,i){if(!/^\d+([.]\d{1,2})?$/.test(n))return!1;var t=parseFloat(n);return!(t<0||t>30)}},this}function Modal(n){var i=this,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=$(n.id),e=o.find(".body"),a=$("body"),r={},s=!1;if(t)var c=e.find("form");o.click(function(t){n.closable||i.toggleState()}),e.click(function(n){return n.stopPropagation()}),n.closer&&e.find(n.closer).click(function(n){return i.toggleState()}),this.opened=!1,n.middleware&&n.middleware(e,r,this),this.toggleState=function(){s||(t&&(i.opened||(c.form("reset"),c.removeClass("error success"))),i.opened?n.onOpen&&n.onClose(e,r,i):n.onOpen&&n.onOpen(e,r,i),o.toggleClass("opened"),i.opened=!i.opened,n.overflowed&&(i.opened?a.css("overflow","hidden"):a.css("overflow","auto")))},this.getBody=function(){return e},this.toggleDisabling=function(){return s=!s},this.isOpened=function(n){return o.hasClass("opened")}}function SignIn(n){new Form(n.getBody().find("form"),"/user/signin",{inline:!0,rules:{email:{identifier:"email",rules:[{type:"email",prompt:"Please enter valid email"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"Please enter password"}]}},on:"submit",success:function(i){n.toggleState(),window.WAuth.signIn(i)},failure:function(n){}})}window.WAuth=new AuthController,window.WProps=new Props,window.WStorage=new Storage,window.WProps.mobilePhone(),window.WProps.currency(),window.WModals={},$(function(n){return setUpSignSystem()});