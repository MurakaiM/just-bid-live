function ReworkActivity(){var n=new Listener(GOING_TIMER),e=new Modal({id:"#waiterModal",middleware:t=>t.find("button").click(t=>{n.ForceAction(),e.toggleState()})});n.ForceStart(n=>{window.WModals.signModal.isOpened()&&window.WModals.signModal.toggleState(),e.toggleState()})}function ReworkAuction(){GET("/auction/current").then(n=>{0==n.code&&(new Auction).LoadState(n.data)}).catch()}function Auction(){$(".pins");const n=$(".empty"),e={},t=io("/auction");t.on("connect",()=>{t.on("bid",n=>e[n.uid].ForceChange(n)),t.on("end",t=>{e[t].ForceEnding(),0==Object.keys(e).length&&n.show()}),t.on("new",t=>{n.hide(),e[t[0]]||(e[t[0]]=new Item(t[1]))}),t.on("stock",n=>e[n[0]].ForceStock(n[1]))}),this.LoadState=(t=>{t.length>0&&n.hide(),t.forEach(n=>e[n[0]]=new Item(n[1]))}),this.LoadNext=(n=>e[data.uid]=new Item(data)),this.ForceChange=((n,t)=>e[n].ForceChange(t))}function Item(n){function e(n,e){var t=e%1e3,i=(e-t)/1e3,o=i-GOING_OFFSET;clearTimeout(c),clearInterval(a),d.currentName.transition("bounce"),d.currentBid.text(n.price/100),d.currentName.text(n.name),c=setTimeout(n=>{r(o,i,getTime(i-GOING_OFFSET)),i--,a=setInterval(()=>{0==i&&clearInterval(a),r(o,i,getTime(i-GOING_OFFSET)),i--},1e3)},t)}function t(n,e,t){s.currentGoing.hide(),s.currentTimer.show(),d.currentProgress.progress({percent:calculatePer(e,t-GOING_OFFSET)}),d.currentTimer.text(n.minutes+":"+n.seconds)}function i(n,e){s.currentTimer.hide(),s.currentGoing.show(),d.currentProgress.progress({percent:calculatePer(10,e-("once"==n?10:0))}),d.currentGoing.text(n)}function r(n,e,r){e>GOING_OFFSET?t(r,n,e):e<=GOING_OFFSET&&e>GOING_OFFSET/2?i("once",e):i("twice",e)}var c,a,o=$(render(n)),s={currentTimer:o.find(".timer"),currentGoing:o.find(".placer")},d={currentId:n.uidRecord,currentProduct:n.uidProduct,currentButton:o.find(".ui.button"),currentTimer:s.currentTimer.find("span"),currentGoing:s.currentGoing.find("span"),currentBid:o.find(".bigger span"),currentName:o.find(".name"),currentProgress:o.find(".ui.progress"),currentDifference:(new Date).getTime()-new Date(n.auctionEnds).getTime()};return void 0==n.currentUser?d.currentTimer.text("Waiting for the first bid"):e(n,Math.abs((new Date).getTime()-new Date(n.auctionEnds).getTime())),d.currentButton.click(n=>POST("/auction/bid",{uidAuction:d.currentId})),this.ForceChange=(n=>e(n,Math.abs((new Date).getTime()-new Date(n.ending).getTime()))),this.ForceEnding=(n=>o.remove()),this.ForceStock=(n=>{d.currentProgress.progress({percent:0}),clearTimeout(c),clearInterval(a),s.currentGoing.hide(),s.currentTimer.show(),d.currentTimer.text("Waiting for the first bid")}),appender.append(o),this}function render(n){return`<div class="col-md-6 col-lg-4">\n        <div class="product">\n          <div class="product-content">          \n            <div class="image">  <img src="${n.mainImage}" alt=""> </div>\n            <div class="titile">\n                ${n.product.prTitle}\n            </div>\n            <div class="name">\n                Adam is Winning\n            </div>\n            <div class="numbers">\n                <span class="price">\n                    <span>RRP:</span>\n                    <i class="fa fa-usd" aria-hidden="true">\n                    </i>${n.product.prCost}</span>\n                <span class="off">${n.offCost}% Off</span>\n            </div>\n\n            <button class="ui button blue_button">\n                <div class="bigger">BID $<span>${n.currentBid/100}</span></div>\n                <div class="smaller">+$${n.offShipment} Shipping</div>\n            </button>\n\n            <div class="going">\n                <div class="timer">\n                    <i class="fa fa-clock-o" aria-hidden="true"></i>\n                    <span> 0:00</span>\n                </div>\n                <div class="placer" style="display:none;">\n                    Going <span>once</span>\n                    <img src="../UserAssets/img/justice.png">\n                </div>\n            </div>\n            <div class="ui indicating tiny progress">\n                <div class="bar"></div>        \n            </div>\n          </div>\n       </div>`}function calculatePer(n,e){return 100*e/n}function getTime(n){var e=Math.floor(n/60),t=n%60;return n||(n=0),e||(e=0),{minutes:(e<10?"0":"")+e,seconds:(t<10?"0":"")+t}}function waiter(){return $(`\n     <div class="empty">\n        <div class="loader"></div>\n        <span> Waiting for new auction items... </span>\n     </div>\n    `)}var GOING_OFFSET=20,GOING_TIMER=8e4;$(function(){appender=$(".pins"),ReworkAuction(),ReworkActivity()});