"use strict";function toCurrency(i){return parseFloat(i).toFixed(2)}function AuthController(){var i,n=this,t=io.connect("/auth");$("body").click(function(i){return n.notification_bell.removeClass("opened")}),$("#btn_signout").click(function(i){return POST("/user/signout")}),$("#btn_signout").popup(),this.currentCount=0,this.isSigned=!1,this.isRedirecting=!1,this.firstLoad=!1,this.notification_cnt=$("#cnt_notification"),this.notification_bell=$("#btn_notification"),this.notification_count=$("#count_notificator"),this.notification_empty=$(".no_notification"),this.notification_login=$(".no_login"),this.listener={},this.userData={},this.notification_cnt.click(function(i){var t=$(i.target);0==t.hasClass("no_notification")&&0==t.hasClass("no_login")&&(n.isRedirecting=!0)}),this.notification_bell.click(function(i){n.loadNotification(),n.notification_bell.addClass("opened"),i.stopPropagation()}),t.on("connect",function(){t.emit("status"),t.emit("count")}),t.on("status",function(t){n.userData=t,clearInterval(i)}),t.on("exit",function(){t.close(),n.switchAuth(!1)}),t.on("disconnect",function(i){return"io server disconnect"===i?console.log("Auth channel was dropped"):console.log("Auth channel was dicsonnected")}),t.on("count",function(i){return n.countNotification(i)}),t.on("new:notification",function(i){return n.newNotification(i)}),t.on("view:notification",function(i){return n.reviewNotification(i)}),t.on("all:notification",function(){return n.reviewAllNotifications()}),$("#rvw_notification").click(function(i){return t.emit("review:all")}),this.on=function(i,t){return n.listener[i]=t},this.signIn=function(o){i=setInterval(function(){return t.connect()},150),n.userData.user=o,n.switchAuth(!0)},this.forceAuth=function(){return t.emit("status")},this.forceLoad=function(i,t){return!!i&&(n.isSigned=!0,n.userData.user=i,!0)},this.switchAuth=function(i){n.swithNotifications(i),n.isSigned=i;var t=$("#user"),o=$("#account");i?(o.css("display","none"),t.css("display","inline"),t.text("Hello, "+n.userData.user.firstName)):(n.countNotification(0),window.location.pathname.includes("seller")?window.location.href="/seller/signin":"/live"!=window.location.pathname&&(window.location.href="/live"),o.css("display","inline"),t.css("display","none"))},this.getData=function(){return n.userData},this.setUid=function(i){i&&(n.userData.user={uid:i})},this.loadNotification=function(){n.firstLoad||GET("/user/notifications/new").then(function(i){n.drawNotification(i.data),n.notification_cnt.removeClass("loading")}).catch(function(i){i.code&&10==i.code&&(n.notification_cnt.removeClass("loading"),n.swithNotifications(!1))})},this.swithNotifications=function(i){i?(n.firstLoad=!1,n.notification_login.hide(),n.notification_empty.show()):(n.notification_cnt.find("a").remove(),n.countNotification(0),n.notification_login.show(),n.notification_empty.hide())},this.countNotification=function(i){n.currentCount=void 0!=i&&null!=i?i:n.currentCount,n.currentCount<=0?n.notification_count.text(""):n.notification_count.text(n.currentCount)},this.reviewNotification=function(i){n.isRedirecting?n.notification_cnt.addClass("loading"):(n.notification_cnt.find('a[data-id="'+i+'"]').remove(),n.currentCount--,n.countNotification(),0==n.currentCount&&(n.notification_cnt.find("a[data-id]").remove(),n.notification_empty.show()))},this.reviewAllNotifications=function(){n.notification_cnt.find("a[data-id]").remove(),n.currentCount=0,n.countNotification(),n.notification_empty.show()},this.newNotification=function(i){n.notification_empty.hide(),n.notification_cnt.prepend(n.createNotification(i)),n.currentCount++,n.countNotification()},this.drawNotification=function(i){n.firstLoad||(n.firstLoad=!0),Array.isArray(i)&&(n.notification_cnt.find("a[data-id]").remove(),i.length>0&&n.notification_empty.hide(),i.forEach(function(i){return n.notification_cnt.append(n.createNotification(i))}))},this.createNotification=function(i){var n={imgUrl:"price-tag-6",action:""};switch(i.type){case"aw":n.imgUrl="justice",n.action="/my/winning/"+i.action;break;case"wch":n.imgUrl="insert-coin",n.action="/notification/review?id="+i.recordId+"&redirect=/my";break;case"fch":n.imgUrl="point-of-service",n.action="/my/winning/"+i.action;break;case"aprv":n.imgUrl="stamp-1",n.action="/notification/review?id="+i.recordId+"&redirect=/seller/mystore#/products";break;case"prcr":n.imgUrl="crate-5",n.action="/notification/review?id="+i.recordId+"&redirect=/seller/mystore#/products";break;default:imgUrl="price-tag-6"}return $('\n         <a class="notification" href="'+n.action+'" data-id="'+i.recordId+'">\n             <div class="image">\n               <img src="/prod/g.assets/img/commercialicons/'+n.imgUrl+'.png" alt="">\n             </div>\n             <div class="data">\n                 <div class="titles">\n                   <span class="title">'+i.title+'</span>\n                   <span class="date">'+new Date(i.updatedAt).toLocaleDateString()+'</span>\n                 </div>\n                 <div class="message">'+i.message+"</div>\n             </div>\n         </a>")}}function setUpSignSystem(){$("body").removeClass("preloading"),$("#account").click(function(i){return window.WModals.signModal.toggleState()}),window.WModals.signModal=new Modal({id:"#signModal"},!0),SignIn(window.WModals.signModal)}function createPrompt(i){return $('<div class="ui basic red pointing prompt label transition visible">'+i+"</div>")}function Form(i,n,t){function o(){d.removeClass("overall error success finished"),t.justbutton?d.find("button:submit").addClass("loading"):d.addClass("loading")}function e(i){m.error.text(i),d.removeClass("loading success"),d.addClass("overall error")}function a(){0==t.reset&&d.form("reset"),d.removeClass("loading error"),d.addClass("overall success"),1==t.finishing&&d.addClass("finished")}function s(){return d.form("get values")}for(var r=arguments.length,c=Array(r>3?r-3:0),u=3;u<r;u++)c[u-3]=arguments[u];var l=!1,d=i instanceof jQuery?i:$("#"+i),f=void 0!==t.delay||null!=t.delay?t.delay:1e3,m={success:d.find(".success p"),error:d.find(".error p")};t.on=t.on?t.on:"blur",d.form({fields:t.rules,inline:t.inline,on:t.on}),d.submit(function(i){return!l&&(i.preventDefault(),l=!0,function(i){var n=1==c[0]?new FormData(d[0]):s();t.dataMiddleware&&(n=t.dataMiddleware(n)),d.form("is valid")?(o(),setTimeout(function(){postForm(i,n,1==c[0]).then(function(i){if(t.justbutton&&d.find("button:submit").removeClass("loading"),i.code>=10)t.failure&&t.failure(i.data,d),e(i.message);else{if(t.success&&t.success(i.data,d),1==t.notSuccess)return;a()}l=!1}).catch(function(i){l=!1,e(i.message)})},f)):l=!1}(n),!1)}),this.setError=e,this.setLoading=o,this.setSuccess=a,this.addField=function(i){t.rules[i.identifier]=i,d.form({fields:t.rules,inline:t.inline,on:t.on})},this.removeField=function(i){delete t.rules[i],d.form({fields:t.rules,inline:t.inline,on:t.on})}}function Storage(){var i=this;this.callbacks=[],this.subscribe=function(i){callbacks.push(i)},this.setItem=function(n,t){i.callbacks.forEach(function(i){return i(n,t)}),localStorage.setItem(n,t)},this.getItem=function(i){return localStorage.getItem(i)}}function postForm(i,n,t){return new Promise(function(o,e){t?backendPostForm(i,n,function(i,n){i?e("Request failed"):404==n.code?e(n.message):o(n)}):backendPost(i,n,function(i,n){i?e("Request failed"):404==n.code?e(n.message):o(n)})})}function backendPost(i,n,t){$.ajax({url:i,type:"POST",contentType:"application/json",data:JSON.stringify(n),success:function(i){t(null,i)},error:function(){t(new Error("Ajax Failed"))}})}function backendPostForm(i,n,t){$.ajax({url:i,type:"POST",data:n,async:!0,success:function(i){t(null,i)},error:function(){t(new Error("Ajax Failed"))},xhr:function(){var i=new window.XMLHttpRequest;return i.upload.addEventListener("progress",function(i){if(i.lengthComputable){var n=i.loaded/i.total;n=parseInt(100*n)}},!1),i},cache:!1,contentType:!1,processData:!1})}function backendGet(i,n){$.ajax({url:i,type:"GET",success:function(i){n(null,i)},error:function(){n(new Error("Ajax Failed"))}})}function GET(i){return new Promise(function(n,t){backendGet(i,function(i,o){return i?t(10):o.code>=10&&o.code<20?t(o):n(o)})})}function FormPOST(i,n){return new Promise(function(t,o){return backendPostForm(i,n,function(i,n){return i?o(10):n.code>=10&&n.code<20?o(n):t(n)})})}function POST(i,n){return new Promise(function(t,o){backendPost(i,n,function(i,n){return i?o(10):n.code>=10&&n.code<20?o(n):t(n)})})}function mobileDeviceInit(){var i=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(i=!0),i}function Props(){return this.isMobile=mobileDeviceInit(),this.isDynamicMobile=function(){return mobileDeviceInit()},this.disableResize=function(){var i=[window.width,window.height];$(window).resize(function(){window.resizeTo(i[0],i[1])})},this.mobilePhone=function(){$.fn.form.settings.rules.phone=function(i,n){var t=(new libphonenumber.asYouType).input(i),o=new libphonenumber.parse(t);return Object.keys(o).length>=2}},this.currency=function(){$.fn.form.settings.rules.currency=function(i,n){return/^\d+([.]\d{1,2})?$/.test(i)},$.fn.form.settings.rules.shipment=function(i,n){if(!/^\d+([.]\d{1,2})?$/.test(i))return!1;var t=parseFloat(i);return!(t<0||t>30)}},this}function Modal(i){var n=this,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=$(i.id),e=o.find(".body"),a=$("body"),s={},r=!1;if(t)var c=e.find("form");o.click(function(t){i.closable||n.toggleState()}),e.click(function(i){return i.stopPropagation()}),i.closer&&e.find(i.closer).click(function(i){return n.toggleState()}),this.opened=!1,i.middleware&&i.middleware(e,s,this),this.toggleState=function(){r||(t&&(n.opened||(c.form("reset"),c.removeClass("error success"))),n.opened?i.onOpen&&i.onClose(e,s,n):i.onOpen&&i.onOpen(e,s,n),o.toggleClass("opened"),n.opened=!n.opened,i.overflowed&&(n.opened?a.css("overflow","hidden"):a.css("overflow","auto")))},this.getBody=function(){return e},this.toggleDisabling=function(){return r=!r},this.isOpened=function(i){return o.hasClass("opened")}}function SignIn(i){new Form(i.getBody().find("form"),"/user/signin",{inline:!0,rules:{email:{identifier:"email",rules:[{type:"email",prompt:"Please enter valid email"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"Please enter password"}]}},on:"submit",success:function(n){i.toggleState(),window.WAuth.signIn(n)},failure:function(i){}})}function Nag(i,n){var t=this;return this.dom=$("#"+i),this.dom.find(".close").click(function(i){localStorage.setItem(n.key,!0),t.dom.hide()}),"true"!=localStorage.getItem(n.key)&&this.dom.css({display:"block"}),this}window.WAuth=new AuthController,window.WProps=new Props,window.WStorage=new Storage,window.WProps.mobilePhone(),window.WProps.currency(),window.WModals={},$(function(i){return setUpSignSystem()});